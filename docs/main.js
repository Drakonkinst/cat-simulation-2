let t=5;const e={setLevel(e){t=e},severe(e){t>=1&&console.error(e)},warn(e){t>=2&&console.warn(e)},info(e){t>=3&&console.log(e)},fine(e){t>=4&&console.log(e)},finer(e){t>=5&&console.log(e)}},n={version:'alpha 2.000',options:{instantButtons:!1,fasterButtons:!1,fasterTasks:!1,loggerLevel:5}};function o(t,e){return t==e?t:Math.random()*(e-t)+t}function i(t,e){return+t.toFixed(e)}const l={},s={};function a(){}class d{constructor({id:t=null,cooldown:n=0,saveCooldown:o=!1,onClick:i=a,onFinish:s=a,text:d='button',tooltip:r=null,width:u=null}={}){this.id=t,this.cooldown=n,this.onCooldown=this.cooldown>0,this.saveCooldown=o,this.element=function(t,e){let n=$('<div>').addClass('button').text(e).on('click',(()=>t.click()));return $('<div>').addClass('cooldown').appendTo(n),n}(this,d),this.onClick=i,this.onFinish=s,null==this.id&&this.saveCooldown&&e.warn('Button with no ID cannot save cooldown'),null!=r&&r.exists()&&r.appendTo(this.element),null!=this.id&&this.element.addClass('button_'+this.id),null!=u&&this.element.css('width',u),null!=this.id&&l.hasOwnProperty(this.id)&&this.startCooldown(l[this.id])}static getButton(t){return s[t]}static saveSavedCooldowns(){return JSON.stringify(l)}static loadSavedCooldowns(t){l=JSON.parse(t)}setText(){this.element.text(text)}setCooldown(t){this.cooldown=t}appendTo(t){return this.element.appendTo(t),this}startCooldown(t=null){let e=this.cooldown,n=100;if(null==t||t>e?t=e:n=t/e*100,e<=2)return void this.finish();this.clearCooldown();let o=this;if(this.element.find('.cooldown').width(n+'%').animate({width:'0%'},t,'linear',(()=>{o.clearCooldown(),o.finish()})),this.saveCooldown){l[this.id]=.001*t;let e=setInterval((function(){if(l[this.id]-.5<0)return delete l[this.id],void clearInterval(e);l[this.id]=i(l[this.id]-.5,2)}),500)}this.onCooldown=!0,this.setDisabled(!0)}click(){if(!this.element.hasClass('disabled')){let t=this.onClick();(null==t||t)&&this.startCooldown()}}finish(){this.onFinish()}clearCooldown(){this.onCooldown=!1,this.setDisabled(!1)}setDisabled(t){t||this.onCooldown?t&&this.element.addClass('disabled'):this.element.removeClass('disabled')}}function r(t){return $(t.target).hasClass('menu-btn')}function u(){return!0}const c={};function h(t){let e=t.split(/[.\[\]'"]+/);for(let t=e.length-1;t>=0;--t)e[t].length<=0&&e.splice(t,1);return e}function p(t,e){let n=h(t),o=c,i=null;for(let t=0;t<n.length;++t){if(i=n[t],'object'!=typeof o||o.hasOwnProperty(i))return e?0:null;o=o[i]}return o}function f(t,n){return function(t,n){let o,i=h(t),l=c,s=null;for(o=0;o<i.length-1;++o)s=i[o],l.hasOwnProperty(s)||(l[s]={}),l=l[s];s=i[o];let a=l.hasOwnProperty(s);return l[s]=n,e.finer('SET '+t+' = '+n),!a}(t,n)}function v(t,n){!function(t,n){let o=p(t,!0);isNaN(o)?e.severe('Tried to add to "'+t+'" which is not a number.'):f(t,o+n)}('player.inventory['+t+']',n)}let w={},m=null,x=null,g=null;function C(t){$('<div>').addClass('notification').css('opacity',0).text(t).prependTo(m).animate({opacity:1},500,'linear',(function(){!function(){let t=x.position().top+x.outerHeight(!0);$('.notification').each((function(){let e=$(this);e.position().top>t&&e.remove()}))}()}))}function b(t){return t.length>0&&!('.!?'.indexOf(t.slice(-1))>-1)&&(e.warn('Message '+t+' does not end with punctuation'),t+='.'),t}function T(t='',e=null,n){t=b(t),null!=e&&p('currentArea')!=e?n||(w.hasOwnProperty(e)||(w[e]=[]),w[e].push(t)):C(t)}class y{constructor(t,e,n,o=n){this.id=t,this.eventTimeout=null,this.callback=function(){e(),this.eventTimeout=null},this.minInterval=n,this.maxInterval=o}scheduleNext(t=1){let n=o(this.minInterval,this.maxInterval)*t;null!=this.eventTimeout&&(clearTimeout(this.eventTimeout),this.eventTimeout=null),n>1?e.finer('Next '+this.id+' event scheduled in '+i(n,2)+' minutes'):e.finer('Next '+this.id+' event scheduled in '+i(60*n,0)+' seconds'),this.eventTimeout=setTimeout(this.callback,6e4*n)}}let k=null,P=null,O=null,S=[],N=[];function I(){return N.length>0?N[0]:null}function L(){return I().eventPanel}function D(){if(N.length<=0){let t=[];for(let e of S)e.isAvailable()&&t.push(e);if(!(t.length>0))return void O.scheduleNext(.5);!function(t){N.push(t),t.eventPanel=$('<div>').addClass('event event-panel').css('opacity',0),$('<div>').addClass('event-title').text(t.title).appendTo(t.eventPanel),$('<div>').addClass('event-description').appendTo(t.eventPanel),$('<div>').addClass('event-buttons').appendTo(t.eventPanel),'function'==typeof t.getContext&&(t.context=t.getContext());let e=E('start',t);null!=e.notification&&T(e.notification);N.length<=1&&B()}(function(t,e=1,n='weight'){let i=0;for(let o of t)o.hasOwnProperty(n)?i+=o[n]:i+=e;let l=o(0,i),s=0,a=0;for(;s<l;){let o=t[a++];o.hasOwnProperty(n)?s+=o[n]:s+=e}return t[a-1]}(t))}O.scheduleNext()}function B(){F('start',!0);let t=L();$('.wrapper').append(t),t.animate({opacity:1},200,'linear'),E(k).blink&&function(){let t=document.title;if(null!=P)return;P=setInterval((()=>{document.title='*** EVENT ***',setTimeout((()=>{document.title=t}),1500)}),3e3)}()}function H(){let t=L();t.animate({opacity:0},200,'linear',(()=>{t.remove();let n=I();delete n.eventPanel,delete n.context,N.shift(),N.length>0?(B(),e.finer(N.length+' events remaining')):(null!=P&&(clearInterval(P),P=null),$('body').trigger('focus'))}))}function F(t,n=!1){e.finer('Loading scene: '+t),k=t;let o=E(t),i=L();'function'==typeof o.onLoad&&o.onLoad(),null==o.notification||n||T(o.notification),null!=o.eventTitle&&$('.event-title',i).text(o.eventTitle),$('.event-description',i).empty(),$('.event-buttons',i).empty(),function(t){let e=L(),n=$('.event-description',e);for(let e=0;e<t.text.length;++e)$('<div>').text(t.text[e]).appendTo(n);if(null!=t.input){document.onselectstart=r,document.onmousedown=r;let e=$('<input>').attr({type:'text',name:'input',spellcheck:!1,placeholder:t.input}).appendTo(n);null!=t.maxinput&&e.attr('maxlength',t.maxinput),$('<div>').addClass('input-result').css('opacity',0).appendTo(n),n.find('input').trigger('focus').trigger('select')}let o=$('<div>').addClass('exit-buttons').appendTo($('.event-buttons',e));null!=t.buttons&&function(t,e){for(let n in t){if(t.hasOwnProperty(n)){let o=t[n],i=new d({id:n,text:o.text,tooltip:o.tooltip||null,onClick:function(){A(this)},cooldown:o.cooldown}).appendTo(e);null!=o.cooldown&&i.startCooldown()}_()}}(t.buttons,o);$('<div>').addClass('clear').appendTo(o)}(o)}function _(){let t=E(k).buttons;for(let e in t)if(t.hasOwnProperty(e)){let n=d.getButton(e),o=t[e];null==o.available||o.available()||n.setDisabled(!0)}}function A(t){let n=E(k),i=n.buttons[t.id];if(null!=i.click){let t=i.click();if(null!=t&&!t){if('string'==typeof t)if(null==n.input)T(t);else{let e=L().find('.input-result');0==e.css('opacity')&&(t=b(t),e.text(t).css('opacity',1).animate({opacity:0},1500,'linear'))}return}null!=n.input&&'end'==i.nextScene&&(document.onselectstart=u,document.onmousedown=u)}if(_(),null!=i.notification&&T(i.notification),null!=i.nextScene)if('end'==i.nextScene)t.setDisabled(!0),H();else{let t=function(t){let e=0;for(let n in t)t.hasOwnProperty(n)&&(e+=t[n]);let n=o(0,e),i=0;for(let e in t)if(t.hasOwnProperty(e)&&(i+=t[e],i>=n))return e;return null}(i.nextScene);if(null==t)return e.severe('No suitable scene found after "'+k+'"'),void H();F(t)}}function E(t,e=null){let n=(e=e||I()).scenes[t];return'function'==typeof n?n(e.context):n}class J{constructor(t='bottom left'){this.element=$('<div>').addClass('tooltip '+t)}addText(t){return $('<div>').text(t).appendTo(this.element),this}addCost(t,e){return $('<div>').addClass('row_key').text(t).appendTo(this.element),$('<div>').addClass('row_val').text(e).appendTo(this.element),this}append(t){return this.element.append(t),this}appendTo(t){return this.element.appendTo(t),this}exists(){return this.element.children().length>0}}window.getState=()=>c,$((()=>{e.setLevel(n.options.loggerLevel),m=$('<div>').addClass('notifications').appendTo('.wrapper'),x=$('<div>').addClass('notify-gradient').appendTo(m),g=$('<div>').addClass('quick-notify').appendTo('.wrapper'),S.push({title:'Noises',isAvailable:()=>!0,scenes:{start:{text:['knocking sounds can be heard through the door.','someone\'s out there.'],notification:'someone\'s knocking outside.',blink:!0,buttons:{investigate:{text:'investigate',nextScene:{bread:1,treats:1}},ignore:{text:'do nothing',nextScene:'end'}}},bread:{text:['a basket full of warm bread sits on the doorstep.','the streets are silent.'],onLoad:()=>{v('bread',5)},buttons:{leave:{text:'close the door',nextScene:'end'}}},treats:{text:['a handful of cat treats sits on the doorstep, wrapped in colorful ribbons.','the streets are silent.'],onLoad:()=>{v('cat treat',3)},buttons:{leave:{text:'go back inside',nextScene:'end'}}}}}),O=new y('random_event',D,3,6),O.scheduleNext(),f('world.day',1),new d({text:'Hello, world!',tooltip:(new J).addCost('soul',1).addText('something\'s out there.'),cooldown:1e3,onClick:()=>{var t;e.info('Hello, world!'),T('Hello, world!'),t=b(t='Hello, world!'),g.stop().text(t).css('opacity',1).animate({opacity:0},3e3,'linear'),D()}}).appendTo($('.main'))}));
//# sourceMappingURL=main.js.map
