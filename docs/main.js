let e=5;const t={setLevel(t){e=t},severe(t){e>=1&&console.error(t)},warn(t){e>=2&&console.warn(t)},info(t){e>=3&&console.log(t)},fine(t){e>=4&&console.log(t)},finer(t){e>=5&&console.log(t)}};function n(e){return Math.random()<e}function o(e,t){return e==t?e:Math.random()*(t-e)+e}function s(e,t){return Math.floor(o(e,t))}function l(e){return e[s(0,e.length)]}class a{constructor(e,t=40,n=15){this.element=$('<div>').addClass('display').css({width:.5*t*20-2,height:.5*n*20-2}).appendTo(e),this.boxes=[],this.doors=[]}addBox(e,t=!0){this.boxes.push(e),t&&this.drawBoxes()}addDoor(e=0){let t=new r({x:e,y:0,width:4,height:8});this.addBox(t),this.doors.push(t)}drawBoxes(){this.element.find('.box').remove();for(let e of this.boxes)e.createElement().appendTo(this.element)}collides(e,n){for(let o of this.boxes)if(o.solid){if(t.fine('checking'),o.intersects(e,n))return t.fine('INTERSECTS'),!0;t.fine('NO INTERSECT')}return!1}getRandomDoor(){return l(this.doors)}}class r{constructor({solid:e=!1,surface:t=!1,height:n=1,width:o=1,x:i=0,y:s=0}={}){this.solid=e,this.surface=t,this.width=o,this.height=n,this.x=i,this.y=s}createElement(){let e=$('<div>').addClass('box').css({width:0==this.width?0:.5*this.width*19-2+1,height:0==this.height?0:.5*this.height*19-2+1,bottom:.5*this.y*19-1,left:.5*this.x*19-1});return 0==this.width&&e.css('border-right','none'),0==this.height&&e.css('border-top','none'),e}intersects(e,n){return t.fine('Checking '+e+', '+n),t.fine(this.x+' '+this.width+'\n'+this.y+' '+this.height),this.x<=e&&e<=this.x+this.width&&this.y<=n&&n<=this.y+this.height}}const d={version:'2.000',saveKey:'game',options:{instantButtons:!1,fasterButtons:!1,fasterTasks:!1,skipIntro:!1,loggerLevel:5}};let c={},h=null,u=null,p=null;function f(e){$('<div>').addClass('notification').css('opacity',0).text(e).prependTo(h).animate({opacity:1},500,'linear',(function(){!function(){let e=u.position().top+u.outerHeight(!0);$('.notification').each((function(){let t=$(this);t.position().top>e&&t.remove()}))}()}))}function m(e){return e.length>0&&!('.!?'.indexOf(e.slice(-1))>-1)&&(t.warn('Message '+e+' does not end with punctuation'),e+='.'),e}function g(e='',t=null,n){e=m(e),null!=t&&M.currentArea!=t?n||(c.hasOwnProperty(t)||(c[t]=[]),c[t].push(e)):f(e)}function w(e){e=m(e),p.stop().text(e).css('opacity',1).animate({opacity:0},3e3,'linear')}function v(e=3e3){$('.notification').stop().animate({opacity:0},e,'linear',(function(){$(this).remove()}))}var y=(()=>{var e=String.fromCharCode,t='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',n='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$',o={};function i(e,t){if(!o[e]){o[e]={};for(var n=0;n<e.length;n++)o[e][e.charAt(n)]=n}return o[e][t]}var s={compressToBase64:e=>{if(null==e)return'';var n=s._compress(e,6,(e=>t.charAt(e)));switch(n.length%4){default:case 0:return n;case 1:return n+'===';case 2:return n+'==';case 3:return n+'='}},decompressFromBase64:e=>null==e?'':''==e?null:s._decompress(e.length,32,(n=>i(t,e.charAt(n)))),compressToUTF16:t=>null==t?'':s._compress(t,15,(t=>e(t+32)))+' ',decompressFromUTF16:e=>null==e?'':''==e?null:s._decompress(e.length,16384,(t=>e.charCodeAt(t)-32)),compressToUint8Array:e=>{for(var t=s.compress(e),n=new Uint8Array(2*t.length),o=0,i=t.length;o<i;o++){var l=t.charCodeAt(o);n[2*o]=l>>>8,n[2*o+1]=l%256}return n},decompressFromUint8Array:t=>{if(null==t)return s.decompress(t);for(var n=new Array(t.length/2),o=0,i=n.length;o<i;o++)n[o]=256*t[2*o]+t[2*o+1];var l=[];return n.forEach((t=>{l.push(e(t))})),s.decompress(l.join(''))},compressToEncodedURIComponent:e=>null==e?'':s._compress(e,6,(e=>n.charAt(e))),decompressFromEncodedURIComponent:e=>null==e?'':''==e?null:(e=e.replace(/ /g,'+'),s._decompress(e.length,32,(t=>i(n,e.charAt(t))))),compress:t=>s._compress(t,16,(t=>e(t))),_compress:(e,t,n)=>{if(null==e)return'';var o,i,s,l={},a={},r='',d='',c='',h=2,u=3,p=2,f=[],m=0,g=0;for(s=0;s<e.length;s+=1)if(r=e.charAt(s),Object.prototype.hasOwnProperty.call(l,r)||(l[r]=u++,a[r]=!0),d=c+r,Object.prototype.hasOwnProperty.call(l,d))c=d;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(o=0;o<p;o++)m<<=1,g==t-1?(g=0,f.push(n(m)),m=0):g++;for(i=c.charCodeAt(0),o=0;o<8;o++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}else{for(i=1,o=0;o<p;o++)m=m<<1|i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i=0;for(i=c.charCodeAt(0),o=0;o<16;o++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[c]}else for(i=l[c],o=0;o<p;o++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1;0==--h&&(h=Math.pow(2,p),p++),l[d]=u++,c=String(r)}if(''!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(o=0;o<p;o++)m<<=1,g==t-1?(g=0,f.push(n(m)),m=0):g++;for(i=c.charCodeAt(0),o=0;o<8;o++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}else{for(i=1,o=0;o<p;o++)m=m<<1|i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i=0;for(i=c.charCodeAt(0),o=0;o<16;o++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[c]}else for(i=l[c],o=0;o<p;o++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(i=2,o=0;o<p;o++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1;for(;;){if(m<<=1,g==t-1){f.push(n(m));break}g++}return f.join('')},decompress:e=>null==e?'':''==e?null:s._decompress(e.length,32768,(t=>e.charCodeAt(t))),_decompress:(t,n,o)=>{var i,s,l,a,r,d,c,h=[],u=4,p=4,f=3,m='',g=[],w={val:o(0),position:n,index:1};for(i=0;i<3;i+=1)h[i]=i;for(l=0,r=Math.pow(2,2),d=1;d!=r;)a=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),l|=(a>0?1:0)*d,d<<=1;switch(l){case 0:for(l=0,r=Math.pow(2,8),d=1;d!=r;)a=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),l|=(a>0?1:0)*d,d<<=1;c=e(l);break;case 1:for(l=0,r=Math.pow(2,16),d=1;d!=r;)a=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),l|=(a>0?1:0)*d,d<<=1;c=e(l);break;case 2:return''}for(h[3]=c,s=c,g.push(c);;){if(w.index>t)return'';for(l=0,r=Math.pow(2,f),d=1;d!=r;)a=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),l|=(a>0?1:0)*d,d<<=1;switch(c=l){case 0:for(l=0,r=Math.pow(2,8),d=1;d!=r;)a=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),l|=(a>0?1:0)*d,d<<=1;h[p++]=e(l),c=p-1,u--;break;case 1:for(l=0,r=Math.pow(2,16),d=1;d!=r;)a=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),l|=(a>0?1:0)*d,d<<=1;h[p++]=e(l),c=p-1,u--;break;case 2:return g.join('')}if(0==u&&(u=Math.pow(2,f),f++),h[c])m=h[c];else{if(c!==p)return null;m=s+s.charAt(0)}g.push(m),h[p++]=s+m.charAt(0),s=m,0==--u&&(u=Math.pow(2,f),f++)}}};return s})();let b={},x=!1;function C(e){let t=e.split(/[.\[\]'"]+/);for(let e=t.length-1;e>=0;--e)t[e].length<=0&&t.splice(e,1);return t}function k(){setInterval(T,6e4)}function T(e=!1){if(x||e){let e=y.compressToUTF16(JSON.stringify(b));localStorage.setItem(d.saveKey,e),x=!1,w('saved.'),t.finer('Saved.')}}function A(e){b=e,T(),t.finer('Loaded state.'),t.finer(b)}function S(){A(JSON.parse(y.decompressFromUTF16(localStorage.getItem(d.saveKey))))}function E(e,t=null){let n=C(e),o=b,i=null;for(let e=0;e<n.length;++e){if(i=n[e],'object'==typeof o&&!o.hasOwnProperty(i))return t;o=o[i]}return o}function O(e,n){return function(e,n){let o,i=C(e),s=b,l=null;for(o=0;o<i.length-1;++o)l=i[o],s.hasOwnProperty(l)||(s[l]={}),s=s[l];l=i[o];let a=s.hasOwnProperty(l);return s[l]=n,x=!0,t.finer('SET '+e+' = '+n),!a}(e,n)}function L(e,n){let o=E(e,0);isNaN(o)?t.severe('Tried to add to "'+e+'" which is not a number.'):O(e,o+n)}var I=Object.freeze({__proto__:null,startAutoSave:k,save:T,load:A,loadFromLocalStorage:S,remove:function(e){let n,o=C(e),i=b,s=null;for(n=0;n<o.length-1;++n){if(s=o[n],!i.hasOwnProperty(s))return!1;i=i[s]}s=o[n];let l=i.hasOwnProperty(s);return l&&(delete i[s],stateChanged=!0,t.finer('REMOVE '+e)),l},get:E,set:O,add:L,getState:function(){return b},printSize:function(){T(),t.info('Compressed Size: '+new Blob(Object.values(localStorage.getItem(d.saveKey))).size/1e3+'kb'),t.info('Uncompressed Size: '+new Blob([JSON.stringify(b)]).size/1e3+'kb')},addItem:function(e,t){L('player.inventory['+e+']',t)},hasItem:function(e,t=1){return E('player.inventory['+e+']',0)>=t}});function N(e){return $(e.target).hasClass('menu-btn')}function _(){return!0}const M={keyLock:!1,navigation:!0,darkMode:!1,darkArea:!1,currentArea:null};function P(e){e?(M.darkMode=!0,$('body').addClass('dark')):(M.darkMode=!1,$('body').removeClass('dark'))}function F(e=null){M.darkArea=e,2==E('options.lights')&&P(!!e)}const z={'american shorthair':{tendencies:['quiet','friendly','playful','calm'],coatColors:['black','blue','silver','brown','tabby'],coatTextures:['short','dense','hard','lustrous'],eyeColors:['blue','copper','green','gold','hazel'],size:'medium'},burmese:{tendencies:['playful','friendly','curious'],coatColors:['blue','platinum','champagne','sable','lilac','fawn','red','cream','chocolate','cinnamon'],coatTextures:['short','silky','glossy','satin'],eyeColors:['gold','yellow'],size:'medium'},'scottish fold':{tendencies:['playful','friendly'],coatColors:['white','blue','black','red','cream','silver'],coatTextures:['short','dense','plush','soft'],eyeColors:['blue','green','gold','bicolored'],size:'medium'},sphinx:{tendencies:['curious','friendly','quiet'],coatColors:['white','black','blue','red','cream','chocolate','lavender'],coatTextures:['hairless','fine'],eyeColors:['blue','red','green','black','pink','grey'],size:'medium'}},B=Object.keys(z),R=['miso','lola','mcgonagall','tara','nala','mistie','misty','coco','tasha','raven','valencia','princess','cherry','chloe','felicia','olivia','emma','belle','luna','minerva','ellie','athena','artemis','poppy','venus','calypso','elise','kathy','elizabeth','hope'],j=['garfield','orpheus','salem','tom','azrael','whiskers','felix','oscar','edgar','sox','ollie','leo','snickers','charcoal','prince','toby','mikesch','buddy','romeo','loki','gavin','momo','illia','theodore','eliot','milo','max','monty','zeke'],D=['lolcat','sesame','unagi','avocado','mango','oreo','swirly','striped','lucky','mittens','angel','dakota','ginger','tippy','snickers','fish','smokey','muffin','fuzzy','nibbles','chaser','pouncer','buttercup'],V=['lazy','playful','loud','quiet','friendly','jumpy','calm','antisocial','curious','active','chaotic','purring','affectionate','intelligent','shy','suspicious','gentle','aggressive','vigilant','hunter','social','dominant'],U=['food','water','litterbox','play','affection','nap'];function H(e){let t=U.indexOf(e);if(t<0)throw'Unknown need "'+e+'"';return t}function K({name:e=null,generateName:t=!0,isFemale:o=n(.5),breed:i=l(B),happiness:a=s(0,101),trust:r=s(0,21),weightClass:d=2}={}){let c=(h=46656*Math.random()|0,u=46656*Math.random()|0,(h=('000'+h.toString(36)).slice(-3))+('000'+u.toString(36)).slice(-3));var h,u;if(null==e&&t){e=l((o?R:j).concat(D))}let p=z[i],f=l(p.coatColors),m=l(p.coatTextures),g=l(p.coatTextures),w=function(e){let t=[];for(let o=0;o<V.length;++o){let i=V[o];e.includes(i)?n(.7)&&t.push(o):n(.02)&&t.push(o)}for(;t.length>5;){let e=s(0,t.length);t.splice(e,1)}return t}(p.tendencies),v=100*d+s(0,100);return new q(c,e,o,i,f,m,g,w,0,0,0,0,0,0,a,r,v)}class q{constructor(e,t,n,o,i,s,l,a=[],r,d,c,h,u,p,f,m,g){this.id=e,this.data={name:t,isFemale:n,breed:o,coatColor:i,coatTexture:s,eyeColor:l,traits:a,needs:[r,d,c,h,u,p],happiness:f,trust:m,weight:g},this.traits=function(e){let t=new Set;for(let n of e)t.add(V[n]);return t}(this.data.traits),this.lastFoodBowl=null,this.lastWaterBowl=null,this.lastLitterbox=null,this.lastNapSpot=null,this.currentRoom=null,this.element=null,this.isSleeping=null,this.currentNeed=null,this.x=0,this.y=0}getHighestNeed(){let e=null,t=-999;for(let n=0;n<U.length;++n){let o=this.data.needs[n];o>t&&(t=o,e=U[n])}return e}setNeed(e,t){let n=H(e);return this.data.needs[n]=t,t}addNeed(e,t){let n=H(e),o=this.needs[n]+t;return this.data.needs[n]=o,o}getNeed(e){let t=H(e);return this.data.needs[t]}move(e,n){null!=this.icon&&(this.x=e,this.y=n,this.icon.css({left:20*e*.5,bottom:20*n*.5-3}),this.currentRoom.display.collides(e,n)&&t.warn('Cat collided with something!'),this.currentRoom.display.collides(e,n+1)?this.icon.text('α'):this.icon.text('@'))}}const J={},W={};function Q(){}class G{constructor({id:e=null,cooldown:n=0,saveCooldown:o=!1,onClick:i=Q,onFinish:s=Q,text:l='button',tooltip:a=null,width:r=null}={}){this.id=e,this.cooldown=n,this.onCooldown=this.cooldown>0,this.saveCooldown=o,this.element=function(e,t){let n=$('<div>').addClass('button').text(t).on('click',(()=>e.click()));return $('<div>').addClass('cooldown').appendTo(n),n}(this,l),this.onClick=i,this.onFinish=s,null==this.id&&this.saveCooldown&&t.warn('Button with no ID cannot save cooldown'),this.setTooltip(a),null!=this.id&&this.element.addClass('button_'+this.id),null!=r&&this.element.css('width',r),null!=this.id&&J.hasOwnProperty(this.id)&&this.startCooldown(J[this.id])}static getButton(e){return W[e]}static saveSavedCooldowns(){return JSON.stringify(J)}static loadSavedCooldowns(e){J=JSON.parse(e)}setText(e){return this.element.text(e),this}setTooltip(e){return null!=this.tooltip&&(this.element.removeChild(this.tooltip.element),this.tooltip=null),null!=e&&e.exists()&&(this.tooltip=e,this.tooltip.appendTo(this.element)),this}setCooldown(e){return this.cooldown=e,this}appendTo(e){return this.element.appendTo(e),this}startCooldown(e=null){let t=this.cooldown,n=100;if(null==e||e>t?e=t:n=e/t*100,t<=2)return void this.finish();this.clearCooldown();let o=this;if(this.element.find('.cooldown').width(n+'%').animate({width:'0%'},e,'linear',(()=>{o.clearCooldown(),o.finish()})),this.saveCooldown){J[this.id]=.001*e;let t=setInterval((function(){if(J[this.id]-.5<0)return delete J[this.id],void clearInterval(t);var e,n;J[this.id]=(e=J[this.id]-.5,n=2,+e.toFixed(n))}),500)}this.onCooldown=!0,this.setDisabled(!0)}click(){if(!this.element.hasClass('disabled')){let e=this.onClick();(null==e||e)&&this.startCooldown()}}finish(){this.onFinish()}clearCooldown(){this.onCooldown=!1,this.setDisabled(!1)}setDisabled(e){return e||this.onCooldown?e&&this.element.addClass('disabled'):this.element.removeClass('disabled'),this}}let X=null,Y=null,Z=[],ee=[],te=new Set,ne=null;function oe(){return ee.length>0?ee[0]:null}function ie(){return oe().eventPanel}function se(){if(ee.length<=0){let e=[];for(let t of Z)t.isAvailable()&&e.push(t);if(!(e.length>0))return void null.scheduleNext(.5);le(function(e,t=1,n='weight'){let i=0;for(let o of e)o.hasOwnProperty(n)?i+=o[n]:i+=t;let s=o(0,i),l=0,a=0;for(;l<s;){let o=e[a++];o.hasOwnProperty(n)?l+=o[n]:l+=t}return e[a-1]}(e))}null.scheduleNext()}function le(e,t=!1){if(null!=e.id){if(te.has(e.id))return;te.add(e.id)}M.keyLock=!0,M.navigation=!1,t?ee.unshift(e):ee.push(e),e.eventPanel=$('<div>').addClass('event event-panel').css('opacity',0),$('<div>').addClass('event-title').text(e.title).appendTo(e.eventPanel),$('<div>').addClass('event-description').appendTo(e.eventPanel),$('<div>').addClass('event-buttons').appendTo(e.eventPanel),'function'==typeof e.getContext&&(e.context=e.getContext());let n=pe('start',e);null!=n.notification&&g(n.notification),(ee.length<=1||t)&&re()}function ae(e){let t=ie();$('div.event-title',t).text(e)}function re(){ce('start',!0);let e=ie();e.appendTo(ne),$('.event-panel').css('opacity',0),e.animate({opacity:1},200,'linear'),pe(X).blink&&function(){let e=document.title;if(null!=Y)return;Y=setInterval((()=>{document.title='*** EVENT ***',setTimeout((()=>{document.title=e}),1500)}),3e3)}()}function de(){let e=ie();e.animate({opacity:0},200,'linear',(()=>{e.remove();let n=oe();delete n.eventPanel,delete n.context,ee.shift(),null!=n.id&&te.delete(n.id),ee.length>0?(re(),t.finer(ee.length+' events remaining')):(null!=Y&&(clearInterval(Y),Y=null),M.keyLock=!1,M.navigation=!0,$('body').trigger('focus'))}))}function ce(e,n=!1){t.finer('Loading scene: '+e),X=e;let o=pe(e),i=ie();'function'==typeof o.onLoad&&o.onLoad(),null==o.notification||n||g(o.notification),null!=o.eventTitle&&$('.event-title',i).text(o.eventTitle),$('.event-description',i).empty(),$('.event-buttons',i).empty(),function(e){let t=ie(),n=$('.event-description',t);for(let t=0;t<e.text.length;++t)$('<div>').text(e.text[t]).appendTo(n);if(null!=e.input){document.onselectstart=N,document.onmousedown=N;let t=$('<input>').attr({type:'text',name:'input',spellcheck:!1,placeholder:e.input}).appendTo(n);null!=e.maxinput&&t.attr('maxlength',e.maxinput),$('<div>').addClass('input-result').css('opacity',0).appendTo(n),n.find('input').trigger('focus').trigger('select')}let o=$('<div>').addClass('exit-buttons').appendTo($('.event-buttons',t));null!=e.buttons&&function(e,t){for(let n in e){if(e.hasOwnProperty(n)){let o=e[n],i=o.text;null==i&&(i=n);let s=new G({id:n,text:i,tooltip:o.tooltip||null,onClick:function(){ue(this)},cooldown:o.cooldown}).appendTo(t);null!=o.cooldown&&s.startCooldown()}he()}}(e.buttons,o);$('<div>').addClass('clear').appendTo(o)}(o)}function he(){let e=pe(X).buttons;for(let t in e)if(e.hasOwnProperty(t)){let n=G.getButton(t),o=e[t];null==o.available||o.available()||n.setDisabled(!0)}}function ue(e){let n=pe(X),i=n.buttons[e.id];if(null!=i.click){let e=i.click();if(null!=e&&!e){if('string'==typeof e)if(null==n.input)g(e);else{let t=ie().find('.input-result');0==t.css('opacity')&&(e=m(e),t.text(e).css('opacity',1).animate({opacity:0},1500,'linear'))}return}null!=n.input&&'end'==i.nextScene&&(document.onselectstart=_,document.onmousedown=_)}if(he(),null!=i.notification&&g(i.notification),null!=i.nextScene)if('end'==i.nextScene)e.setDisabled(!0),de();else if('string'==typeof i.nextScene)ce(i.nextScene);else{let e=function(e){let t=0;for(let n in e)e.hasOwnProperty(n)&&(t+=e[n]);let n=o(0,t),i=0;for(let t in e)if(e.hasOwnProperty(t)&&(i+=e[t],i>=n))return t;return null}(i.nextScene);if(null==e)return t.severe('No suitable scene found after "'+X+'"'),void de();ce(e)}}function pe(e,t=null){let n=(t=t||oe()).scenes[e];return'function'==typeof n?n(t.context):n}const fe={};class me{constructor(e,t){this.id=e,this.name=t,this.isVisible=!0,this.element=null,this.buttonElement=null,this.onLoadCallback=()=>{},this.onArrivalCallback=()=>{}}createElement(e,t,n){this.buttonElement=$('<div>').addClass('location-button location-button_'+this.id).text(this.name).on('click',(()=>{e.goToLocation(i)})).appendTo(t),this.element=$('<div>').addClass('location location_'+this.id).appendTo(n),this.onCreateElement()}onCreateElement(){}onLoad(e){return null==e?this.onLoadCallback(this):this.onLoadCallback=e,this}onArrival(e){return null==e?this.onArrivalCallback(this):this.onArrivalCallback=e,this}setName(e,t=!1){this.name=e,this.buttonElement.text(this.name),t&&this.buttonElement.hide().fadeIn(500,'linear')}setVisible(e){return this.isVisible=e,null==this.element||null==this.buttonElement||(e?this.buttonElement.fadeIn(500,'linear'):this.buttonElement.hide()),this}}class ge{constructor(e,t){this.id=e,this.name=t,this.locations=[],this.currentIndex=-1,this.isVisible=!0,this.element=null,this.buttonElement=null}Init(){for(let e of this.locations)e.onLoad(),e.setVisible(e.isVisible);this.goToLocation(0)}onArrival(e){!function(e){if(c.hasOwnProperty(e))for(;c[e].length;)Notifications.printMessage(c[e].shift())}(this.id)}addLocation(e){this.locations.push(e)}addLocations(...e){for(let t of e)this.addLocation(t)}getLocation(e){return e<0||e>=this.locations.length?null:this.locations[e]}goToLocation(e){if(e<0||e>=this.locations.length)return void t.warn('Tried to go to invalid location index '+e);if(this.currentIndex==e)return;let n=this.locations[e];this.element.find('.location-button').removeClass('selected'),n.buttonElement.addClass('selected');let o=this.element.find('.location-content .location-slider'),i=o.find('.location').index(n.element),s=this.currentIndex>-1?this.currentIndex:0,l=Math.abs(i-s);o.animate({top:-624*i+'px'},300*l),n.onArrival(),this.currentIndex=e}createElement(){if(null!=this.element)return this.element;let e=$('<div>').addClass('area-panel area-panel_'+this.id),t=$('<div>').addClass('location-content').appendTo(e),n=$('<div>').addClass('location-select').appendTo(e),o=$('<div>').addClass('location-slider').appendTo(t);for(let e=0;e<this.locations.length;++e)this.locations[e].createElement(this,n,o);return this.element=e,e}setName(e,t=!1){this.name=e,this.buttonElement.text(this.name),t&&this.buttonElement.hide().fadeIn(500,'linear')}setVisible(e){return this.isVisible=e,null==this.element||null==this.buttonElement||(e?(this.buttonElement.fadeIn(200,'linear'),this.element.show()):(this.buttonElement.hide(),this.element.hide())),this}}function we(e){let t=$('<div>').addClass('area-button area-button_'+e.id).text(e.name).on('click',(()=>{ve(e.id)})).appendTo('.area-select');e.buttonElement=t,e.createElement().appendTo('.area-slider'),fe[e.id]=e}function ve(e){if(M.currentArea==e)return;t.finer('Traveling to area '+e);let n=fe[e];if(null==n)return void t.severe('Invalid area '+e);$('.area-button').removeClass('selected'),n.buttonElement.addClass('selected');let o=$('.area-slider'),i=$('.area-panel').index(n.element),s=null==M.currentArea?0:$('.area-panel').index(fe[M.currentArea].element),l=Math.abs(i-s);o.animate({left:-700*i+'px'},300*l),M.currentArea=e,n.onArrival(l)}const ye=['a blue sea, waves gently lapping against the shore','dark and stormy nights','dreamed of a blazing inferno, heat unbearable','bright skies and lazy clouds','crackling thunder and pouring rain','soft flakes of snow','merciless ice hurtling from the sky','soft whispers and a warm embrace','fish swimming across the sky','a hunter stalking its prey','a world covered in ash','a land of unyielding stone, not a blade of grass in sight','a blazing radiance, the heat of the sun\'s fury','crimson mist and a wolf\'s howl','a trident buried deep in the sea','a field of stars, glistening in the darkness'];class be{constructor(e='bottom left'){this.element=$('<div>').addClass('tooltip '+e)}addText(e){return $('<div>').text(e).appendTo(this.element),this}addCost(e,t){return $('<div>').addClass('row_key').text(e).appendTo(this.element),$('<div>').addClass('row_val').text(t).appendTo(this.element),this}append(e){return this.element.append(e),this}appendTo(e){return this.element.appendTo(e),this}exists(){return this.element.children().length>0}}const xe=['dreamed of white sails flying in the salty air.','dreamed of stormy seas and raging tides.','dreamed of a bottomless abyss, rays of light fading away.'],Ce=['something purrs softly.','feather-soft whiskers brush past.','purring grows more insistent.','something paws gently.'];function ke(e){let t=E('progress.intro.step',0),n=e.getLocation(0);if(n.setName(''),e.setName(''),t<=3){let o=function(e,t){const n=new G({id:'intro',text:'wake up',cooldown:5e3,onClick:()=>{let e=E('progress.intro.step',0);if(e<xe.length){g(xe[e])}else g('the world beckons, and dreams start to fade.'),v()},onFinish:()=>{L('progress.intro.step',1);let o=E('progress.intro.step');o==xe.length&&Te(e,n),o>=4&&(n.element.remove(),$('.button_random-dream').remove(),Ee(e,t))}}).appendTo(e.element);return n}(n,e);3==t&&Te(n,o)}t>=4&&Ee(n,e)}function Te(e,t){g('dream\'s embrace is inviting. would be so nice to give in, just for a while longer.');let n=3;const o=new G({id:'random-dream',text:'dream',cooldown:5e3,onClick:()=>{g('dreamed of '+l(ye)+'.')},onFinish:()=>{--n<=0&&(v(),g('dreams fade away like fleeting memories.'),o.setDisabled(!0))}});return o.element.prependTo(e.element),$e=setTimeout(Se,1e4),t.setCooldown(8e3),T(),o}let $e=null,Ae=0;function Se(){g(Ce[Ae]),Ae=(Ae+1)%Ce.length,$e=setTimeout(Se,o(1e4,2e4))}function Ee(e,t){t.setName('A Dark Room',!0),new G({id:'sleep',text:'sleep',cooldown:6e4}).appendTo(e.element).setTooltip((new be).addText('slept enough for now.')).setDisabled(!0),function(e){const t=new G({id:e.id+'-lights',text:'lights on',onClick:()=>{let n='house.room_'+e.id+'.lights',o=E(n,!1);o?(t.setText('lights on'),F(!0)):(t.setText('lights off'),F(!1)),O(n,!o)}});return t}(e).appendTo(e.element).element.one('click',(()=>{t.setName('A Lonely Room')})),F(!0),v(),g('the room is cold.'),setTimeout((()=>{g('a curious face peeks up between the bedsheets.'),le({title:'A Curious Face',scenes:{start:{text:['a strange creature looks up at you inquisitively.'],buttons:{hello:{text:'say hello',click:()=>{g('nothing here yet.')},nextScene:'end'}}}}})}),3e3),clearTimeout($e),$e=null,T()}class Oe extends me{constructor(e,t){super(e,t),this.cats=[]}onCreateElement(){t.info('CREATED'),$('<div>').addClass('room-controls').appendTo(this.element),this.display=new a(this.element)}onCatArrival(e,n=0,o=0){this.cats.push(e),e.currentRoom=this;let i='cat_'+e.id;e.icon=$('<span>').addClass('cat '+i).on('click',(()=>{t.info('Clicked on '+e.data.name+' ('+e.id+')')})),new be('top left').addText(e.data.name).appendTo(e.icon),e.icon.css('opacity',0).animate({opacity:1},200,'linear').appendTo(this.display.element),e.move(n,o)}onCatLeave(e){let n=this.cats.indexOf(e);if(n<0)t.warn('Tried to make cat '+e.id+' leave room '+this.id+' but it was not there');else if(this.cats.splice(n,1),e.currentRoom=null,e.id,null!=e.icon){let t=$('<span>').addClass('cat').text('@').css('opacity',1);e.icon.replaceWith(t.animate({opacity:0},200,'linear',(()=>{t.remove()}))),e.icon=null}}}const Le=new ge('house','');function Ie(e){O('house.cats['+e.id+']',e.data)}const Ne=new ge('town','A Quiet Town');function _e(){!function(){let e=$('.main');$('<div>').addClass('area-select').appendTo(e),$('<div>').addClass('area-slider').appendTo(e)}(),function(){const e=new Oe('bedroom','Bedroom').onLoad((e=>{E('progress.intro.finished',!1)||ke(Le),new G({text:'cat',onClick:()=>{let n=K();Ie(n),e.onCatArrival(n,2,3),t.info(n.id+' CAT1');let o=K();Ie(o),e.onCatArrival(o,3,0),t.info(o.id+' CAT2')}}).appendTo(e.element),e.display.addBox(new r({x:1,y:1,width:10,height:2,solid:!0,surface:!0})),e.display.addBox(new r({x:1,y:1,width:3,height:2,solid:!0,surface:!0})),e.display.addBox(new r({x:1,y:0,width:0,height:1})),e.display.addBox(new r({x:11,y:0,width:0,height:1}))}));Le.addLocations(e,new Oe('hallway','Hallway').setVisible(!1)),we(Le),Le.Init()}(),Ne.addLocations(new me('store','Store').onLoad((()=>{})),new me('park','Park')),we(Ne),Ne.Init(),Ne.setVisible(!1),function(){let e=$('.area-slider');e.width(700*e.children().length+'px')}()}function Me(){let e=$('<div>').addClass('footer').appendTo('body');$('<span>').addClass('footer-button version').text('v'+d.version).appendTo(e),$('<span>').addClass('footer-button github').text('github.').on('click',(()=>{window.open('https://github.com/Drakonkinst/cat-simulation-2')})).appendTo(e),$('<span>').addClass('footer-button').text('discord.').on('click',(()=>{window.open('https://discord.gg/Wrp7Fre')})).appendTo(e),$('<span>').addClass('footer-button').text('options.').on('click',(()=>{le({title:'Options',id:'options',getContext:()=>E('options.lights',0),scenes:{start:e=>({text:['set to heart\'s desire.'],onLoad:()=>{ae('Options')},buttons:{lights:{text:Pe(e),click:()=>{let e=E('options.lights',0);var t;e=(e+1)%3,O('options.lights',t=e),0==t?P(!1):1==t?P(!0):2==t&&F(M.darkArea),$('.button.button_lights').text(Pe(e))}},save:{nextScene:'export_import',click:()=>{T()}},restart:{nextScene:'confirm_restart'},close:{nextScene:'end'}}}),confirm_restart:{text:['restart the game?'],onLoad:()=>{ae('Restart?')},buttons:{yes:{click:()=>{localStorage.removeItem(d.saveKey),location.reload()},nextScene:'end'},no:{nextScene:'start'}}},export_import:{text:['export or import save data','for backing up or migrating computers'],onLoad:()=>{ae('Export / Import')},buttons:{export:{click:()=>{g('nothing here yet.')}},import:{click:()=>{g('nothing here yet.')}},cancel:{nextScene:'start'}}}}},!0)})).appendTo(e)}function Pe(e){let t='lights: ';return 0==e?t+='on':1==e?t+='off':2==e&&(t+='adaptive'),t}function Fe(){t.setLevel(d.options.loggerLevel),Me(),h=$('<div>').addClass('notifications').appendTo('.wrapper'),u=$('<div>').addClass('notify-gradient').appendTo(h),p=$('<div>').addClass('quick-notify').appendTo('.wrapper'),localStorage.hasOwnProperty(d.saveKey)?S():(O('world.day',1),O('options.lights',0),O('progress.unlocked.town',!1)),ne=$('<div>').addClass('events').appendTo('.wrapper'),_e(),k(),window.$SM=I}$((()=>{Fe(),ve('house'),new G({text:'Hello, world!',tooltip:(new be).addCost('soul',1).addText('something\'s out there.'),cooldown:1e3,onClick:()=>{t.info('Hello, world!'),g('Hello, world!'),w('Hello, world!'),se()}})}));
//# sourceMappingURL=main.js.map
