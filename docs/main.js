let e=5;const t={setLevel(t){e=t},severe(t){e>=1&&console.error(t)},warn(t){e>=2&&console.warn(t)},info(t){e>=3&&console.log(t)},fine(t){e>=4&&console.log(t)},finer(t){e>=5&&console.log(t)}},n={version:'2.000',saveKey:'game',options:{instantButtons:!1,fasterButtons:!1,fasterTasks:!1,skipIntro:!1,loggerLevel:5}};let o={},i=null,l=null,s=null;function a(e){$('<div>').addClass('notification').css('opacity',0).text(e).prependTo(i).animate({opacity:1},500,'linear',(function(){!function(){let e=l.position().top+l.outerHeight(!0);$('.notification').each((function(){let t=$(this);t.position().top>e&&t.remove()}))}()}))}function r(e){return e.length>0&&!('.!?'.indexOf(e.slice(-1))>-1)&&(t.warn('Message '+e+' does not end with punctuation'),e+='.'),e}function d(e='',t=null,n){e=r(e),null!=t&&T.currentArea!=t?n||(o.hasOwnProperty(t)||(o[t]=[]),o[t].push(e)):a(e)}function c(e){e=r(e),s.stop().text(e).css('opacity',1).animate({opacity:0},3e3,'linear')}function u(e=3e3){$('.notification').stop().animate({opacity:0},e,'linear',(function(){$(this).remove()}))}let h={},p=!1;function f(e){let t=e.split(/[.\[\]'"]+/);for(let e=t.length-1;e>=0;--e)t[e].length<=0&&t.splice(e,1);return t}function m(){setInterval(g,6e4)}function g(e=!1){(p||e)&&(localStorage.setItem(n.saveKey,JSON.stringify(h)),p=!1,c('saved.'),t.finer('Saved.'))}function v(e){h=e,g(),t.finer('Loaded state.'),t.finer(h)}function w(e,t=null){let n=f(e),o=h,i=null;for(let e=0;e<n.length;++e){if(i=n[e],'object'==typeof o&&!o.hasOwnProperty(i))return t;o=o[i]}return o}function b(e,n){return function(e,n){let o,i=f(e),l=h,s=null;for(o=0;o<i.length-1;++o)s=i[o],l.hasOwnProperty(s)||(l[s]={}),l=l[s];s=i[o];let a=l.hasOwnProperty(s);return l[s]=n,p=!0,t.finer('SET '+e+' = '+n),!a}(e,n)}function y(e,n){let o=w(e,0);isNaN(o)?t.severe('Tried to add to "'+e+'" which is not a number.'):b(e,o+n)}var x=Object.freeze({__proto__:null,startAutoSave:m,save:g,load:v,remove:function(e){let n,o=f(e),i=h,l=null;for(n=0;n<o.length-1;++n){if(l=o[n],!i.hasOwnProperty(l))return!1;i=i[l]}l=o[n];let s=i.hasOwnProperty(l);return s&&(delete i[l],stateChanged=!0,t.finer('REMOVE '+e)),s},get:w,set:b,add:y,getState:function(){return h},addItem:function(e,t){y('player.inventory['+e+']',t)},hasItem:function(e,t=1){return w('player.inventory['+e+']',0)>=t}});function C(e){return $(e.target).hasClass('menu-btn')}function k(){return!0}const T={keyLock:!1,navigation:!0,darkMode:!1,darkArea:!1,currentArea:null};function L(e){e?(T.darkMode=!0,$('body').addClass('dark')):(T.darkMode=!1,$('body').removeClass('dark'))}function S(e=null){T.darkArea=e,2==w('options.lights')&&L(!!e)}function I(e){return Math.random()<e}function O(e,t){return e==t?e:Math.random()*(t-e)+e}function E(e){return e[(t=0,n=e.length,Math.floor(O(t,n)))];var t,n}const A=['miso','lola','mcgonagall','tara','nala','mistie','misty','coco','tasha','raven','valencia','princess','cherry','chloe','felicia','olivia','emma','belle','luna','minerva','ellie','athena','artemis','poppy','venus','calypso','elise','kathy','elizabeth','hope'],N=['garfield','orpheus','salem','tom','azrael','whiskers','felix','oscar','edgar','sox','ollie','leo','snickers','charcoal','prince','toby','mikesch','buddy','romeo','loki','gavin','momo','illia','theodore','eliot','milo','max','monty','zeke'],P=['lolcat','sesame','unagi','avocado','mango','oreo','swirly','striped','lucky','mittens','angel','dakota','ginger','tippy','snickers','fish','smokey','muffin','fuzzy','nibbles','chaser','pouncer','buttercup'],_=['food','water','litterbox','play','affection','nap'];function M(e){let t=_.indexOf(e);if(t<0)throw'Unknown need "'+e+'"';return t}class V{constructor(e,t,n,o,i,l,s=[],a,r,d,c,u,h,p,f){this.info={name:e,isFemale:t,breed:n,coatColor:o,coatTexture:i,eyeColor:l,traits:s},this.data={needs:[a,r,d,c,u,h],happiness:p,trust:f},this.traits=new Set(s),this.lastFoodBowl=null,this.lastWaterBowl=null,this.lastLitterbox=null,this.lastNapSpot=null}getHighestNeed(){let e=null,t=-999;for(let n=0;n<_.length;++n){let o=this.data.needs[n];o>t&&(t=o,e=_[n])}return e}setNeed(e,t){let n=M(e);return this.data.needs[n]=t,t}addNeed(e,t){let n=M(e),o=this.needs[n]+t;return this.data.needs[n]=o,o}getNeed(e){let t=M(e);return this.data.needs[t]}}const F={},D={};function z(){}class B{constructor({id:e=null,cooldown:n=0,saveCooldown:o=!1,onClick:i=z,onFinish:l=z,text:s='button',tooltip:a=null,width:r=null}={}){this.id=e,this.cooldown=n,this.onCooldown=this.cooldown>0,this.saveCooldown=o,this.element=function(e,t){let n=$('<div>').addClass('button').text(t).on('click',(()=>e.click()));return $('<div>').addClass('cooldown').appendTo(n),n}(this,s),this.onClick=i,this.onFinish=l,null==this.id&&this.saveCooldown&&t.warn('Button with no ID cannot save cooldown'),this.setTooltip(a),null!=this.id&&this.element.addClass('button_'+this.id),null!=r&&this.element.css('width',r),null!=this.id&&F.hasOwnProperty(this.id)&&this.startCooldown(F[this.id])}static getButton(e){return D[e]}static saveSavedCooldowns(){return JSON.stringify(F)}static loadSavedCooldowns(e){F=JSON.parse(e)}setText(e){return this.element.text(e),this}setTooltip(e){return null!=this.tooltip&&(this.element.removeChild(this.tooltip.element),this.tooltip=null),null!=e&&e.exists()&&(this.tooltip=e,this.tooltip.appendTo(this.element)),this}setCooldown(e){return this.cooldown=e,this}appendTo(e){return this.element.appendTo(e),this}startCooldown(e=null){let t=this.cooldown,n=100;if(null==e||e>t?e=t:n=e/t*100,t<=2)return void this.finish();this.clearCooldown();let o=this;if(this.element.find('.cooldown').width(n+'%').animate({width:'0%'},e,'linear',(()=>{o.clearCooldown(),o.finish()})),this.saveCooldown){F[this.id]=.001*e;let t=setInterval((function(){if(F[this.id]-.5<0)return delete F[this.id],void clearInterval(t);var e,n;F[this.id]=(e=F[this.id]-.5,n=2,+e.toFixed(n))}),500)}this.onCooldown=!0,this.setDisabled(!0)}click(){if(!this.element.hasClass('disabled')){let e=this.onClick();(null==e||e)&&this.startCooldown()}}finish(){this.onFinish()}clearCooldown(){this.onCooldown=!1,this.setDisabled(!1)}setDisabled(e){return e||this.onCooldown?e&&this.element.addClass('disabled'):this.element.removeClass('disabled'),this}}let H=null,K=null,J=[],R=[],j=new Set,q=null;function W(){return R.length>0?R[0]:null}function Q(){return W().eventPanel}function U(){if(R.length<=0){let e=[];for(let t of J)t.isAvailable()&&e.push(t);if(!(e.length>0))return void null.scheduleNext(.5);G(function(e,t=1,n='weight'){let o=0;for(let i of e)i.hasOwnProperty(n)?o+=i[n]:o+=t;let i=O(0,o),l=0,s=0;for(;l<i;){let o=e[s++];o.hasOwnProperty(n)?l+=o[n]:l+=t}return e[s-1]}(e))}null.scheduleNext()}function G(e,t=!1){if(null!=e.id){if(j.has(e.id))return;j.add(e.id)}T.keyLock=!0,T.navigation=!1,t?R.unshift(e):R.push(e),e.eventPanel=$('<div>').addClass('event event-panel').css('opacity',0),$('<div>').addClass('event-title').text(e.title).appendTo(e.eventPanel),$('<div>').addClass('event-description').appendTo(e.eventPanel),$('<div>').addClass('event-buttons').appendTo(e.eventPanel),'function'==typeof e.getContext&&(e.context=e.getContext());let n=oe('start',e);null!=n.notification&&d(n.notification),(R.length<=1||t)&&Y()}function X(e){let t=Q();$('div.event-title',t).text(e)}function Y(){ee('start',!0);let e=Q();e.appendTo(q),$('.event-panel').css('opacity',0),e.animate({opacity:1},200,'linear'),oe(H).blink&&function(){let e=document.title;if(null!=K)return;K=setInterval((()=>{document.title='*** EVENT ***',setTimeout((()=>{document.title=e}),1500)}),3e3)}()}function Z(){let e=Q();e.animate({opacity:0},200,'linear',(()=>{e.remove();let n=W();delete n.eventPanel,delete n.context,R.shift(),null!=n.id&&j.delete(n.id),R.length>0?(Y(),t.finer(R.length+' events remaining')):(null!=K&&(clearInterval(K),K=null),T.keyLock=!1,T.navigation=!0,$('body').trigger('focus'))}))}function ee(e,n=!1){t.finer('Loading scene: '+e),H=e;let o=oe(e),i=Q();'function'==typeof o.onLoad&&o.onLoad(),null==o.notification||n||d(o.notification),null!=o.eventTitle&&$('.event-title',i).text(o.eventTitle),$('.event-description',i).empty(),$('.event-buttons',i).empty(),function(e){let t=Q(),n=$('.event-description',t);for(let t=0;t<e.text.length;++t)$('<div>').text(e.text[t]).appendTo(n);if(null!=e.input){document.onselectstart=C,document.onmousedown=C;let t=$('<input>').attr({type:'text',name:'input',spellcheck:!1,placeholder:e.input}).appendTo(n);null!=e.maxinput&&t.attr('maxlength',e.maxinput),$('<div>').addClass('input-result').css('opacity',0).appendTo(n),n.find('input').trigger('focus').trigger('select')}let o=$('<div>').addClass('exit-buttons').appendTo($('.event-buttons',t));null!=e.buttons&&function(e,t){for(let n in e){if(e.hasOwnProperty(n)){let o=e[n],i=o.text;null==i&&(i=n);let l=new B({id:n,text:i,tooltip:o.tooltip||null,onClick:function(){ne(this)},cooldown:o.cooldown}).appendTo(t);null!=o.cooldown&&l.startCooldown()}te()}}(e.buttons,o);$('<div>').addClass('clear').appendTo(o)}(o)}function te(){let e=oe(H).buttons;for(let t in e)if(e.hasOwnProperty(t)){let n=B.getButton(t),o=e[t];null==o.available||o.available()||n.setDisabled(!0)}}function ne(e){let n=oe(H),o=n.buttons[e.id];if(null!=o.click){let e=o.click();if(null!=e&&!e){if('string'==typeof e)if(null==n.input)d(e);else{let t=Q().find('.input-result');0==t.css('opacity')&&(e=r(e),t.text(e).css('opacity',1).animate({opacity:0},1500,'linear'))}return}null!=n.input&&'end'==o.nextScene&&(document.onselectstart=k,document.onmousedown=k)}if(te(),null!=o.notification&&d(o.notification),null!=o.nextScene)if('end'==o.nextScene)e.setDisabled(!0),Z();else if('string'==typeof o.nextScene)ee(o.nextScene);else{let e=function(e){let t=0;for(let n in e)e.hasOwnProperty(n)&&(t+=e[n]);let n=O(0,t),o=0;for(let t in e)if(e.hasOwnProperty(t)&&(o+=e[t],o>=n))return t;return null}(o.nextScene);if(null==e)return t.severe('No suitable scene found after "'+H+'"'),void Z();ee(e)}}function oe(e,t=null){let n=(t=t||W()).scenes[e];return'function'==typeof n?n(t.context):n}const ie={};class le{constructor(e,t){this.id=e,this.name=t,this.isVisible=!0,this.element=null,this.buttonElement=null,this.onLoadCallback=()=>{},this.onArrivalCallback=()=>{}}onLoad(e){return null==e?this.onLoadCallback(this):this.onLoadCallback=e,this}onArrival(e){return null==e?this.onArrivalCallback(this):this.onArrivalCallback=e,this}setName(e,t=!1){this.name=e,this.buttonElement.text(this.name),t&&this.buttonElement.hide().fadeIn(500,'linear')}setVisible(e){return this.isVisible=e,null==this.element||null==this.buttonElement||(e?this.buttonElement.fadeIn(500,'linear'):this.buttonElement.hide()),this}}class se{constructor(e,t){this.id=e,this.name=t,this.locations=[],this.currentIndex=-1,this.isVisible=!0,this.element=null,this.buttonElement=null}Init(){for(let e of this.locations)e.onLoad(),e.setVisible(e.isVisible);this.goToLocation(0)}onArrival(e){!function(e){if(o.hasOwnProperty(e))for(;o[e].length;)Notifications.printMessage(o[e].shift())}(this.id)}addLocation(e){this.locations.push(e)}addLocations(...e){for(let t of e)this.addLocation(t)}getLocation(e){return e<0||e>=this.locations.length?null:this.locations[e]}goToLocation(e){if(e<0||e>=this.locations.length)return void t.warn('Tried to go to invalid location index '+e);if(this.currentIndex==e)return;let n=this.locations[e];this.element.find('.location-button').removeClass('selected'),n.buttonElement.addClass('selected');let o=this.element.find('.location-content .location-slider'),i=o.find('.location').index(n.element),l=this.currentIndex>-1?this.currentIndex:0,s=Math.abs(i-l);o.animate({top:-624*i+'px'},300*s),n.onArrival(),this.currentIndex=e}createElement(){if(null!=this.element)return this.element;let e=$('<div>').addClass('area-panel area-panel_'+this.id),t=$('<div>').addClass('location-select').appendTo(e),n=$('<div>').addClass('location-content').appendTo(e),o=$('<div>').addClass('location-slider').appendTo(n),i=this;for(let e=0;e<this.locations.length;++e){let n=this.locations[e];n.buttonElement=$('<div>').addClass('location-button location-button_'+n.id).text(n.name).on('click',(()=>{i.goToLocation(e)})).appendTo(t),n.element=$('<div>').addClass('location location_'+n.id).appendTo(o)}return this.element=e,e}setName(e,t=!1){this.name=e,this.buttonElement.text(this.name),t&&this.buttonElement.hide().fadeIn(500,'linear')}setVisible(e){return this.isVisible=e,null==this.element||null==this.buttonElement||(e?(this.buttonElement.fadeIn(200,'linear'),this.element.show()):(this.buttonElement.hide(),this.element.hide())),this}}function ae(e){let t=$('<div>').addClass('area-button area-button_'+e.id).text(e.name).on('click',(()=>{re(e.id)})).appendTo('.area-select');e.buttonElement=t,e.createElement().appendTo('.area-slider'),ie[e.id]=e}function re(e){if(T.currentArea==e)return;t.finer('Traveling to area '+e);let n=ie[e];if(null==n)return void t.severe('Invalid area '+e);$('.area-button').removeClass('selected'),n.buttonElement.addClass('selected');let o=$('.area-slider'),i=$('.area-panel').index(n.element),l=null==T.currentArea?0:$('.area-panel').index(ie[T.currentArea].element),s=Math.abs(i-l);o.animate({left:-700*i+'px'},300*s),T.currentArea=e,n.onArrival(s)}const de=['a blue sea, waves gently lapping against the shore','dark and stormy nights','dreamed of a blazing inferno, heat unbearable','bright skies and lazy clouds','crackling thunder and pouring rain','soft flakes of snow','merciless ice hurtling from the sky','soft whispers and a warm embrace','fish swimming across the sky','a hunter stalking its prey','a world covered in ash','a land of unyielding stone, not a blade of grass in sight','a blazing radiance, the heat of the sun\'s fury','crimson mist and a wolf\'s howl','a trident buried deep in the sea','a field of stars, glistening in the darkness'];class ce{constructor(e='bottom left'){this.element=$('<div>').addClass('tooltip '+e)}addText(e){return $('<div>').text(e).appendTo(this.element),this}addCost(e,t){return $('<div>').addClass('row_key').text(e).appendTo(this.element),$('<div>').addClass('row_val').text(t).appendTo(this.element),this}append(e){return this.element.append(e),this}appendTo(e){return this.element.appendTo(e),this}exists(){return this.element.children().length>0}}const ue=['dreamed of white sails flying in the salty air.','dreamed of stormy seas and raging tides.','dreamed of a bottomless abyss, rays of light fading away.'],he=['something purrs softly.','feather-soft whiskers brush past.','purring grows more insistent.','something paws gently.'];function pe(e){let t=w('progress.intro.step',0),n=e.getLocation(0);if(n.setName(''),e.setName(''),t<=3){let o=function(e,t){const n=new B({id:'intro',text:'wake up',cooldown:5e3,onClick:()=>{let e=w('progress.intro.step',0);if(e<ue.length){d(ue[e])}else d('the world beckons, and dreams start to fade.'),u()},onFinish:()=>{y('progress.intro.step',1);let o=w('progress.intro.step');o==ue.length&&fe(e,n),o>=4&&(n.element.remove(),$('.button_random-dream').remove(),we(e,t))}}).appendTo(e.element);return n}(n,e);3==t&&fe(n,o)}t>=4&&we(n,e)}function fe(e,t){d('dream\'s embrace is inviting. would be so nice to give in, just for a while longer.');let n=3;const o=new B({id:'random-dream',text:'dream',cooldown:5e3,onClick:()=>{d('dreamed of '+E(de)+'.')},onFinish:()=>{--n<=0&&(u(),d('dreams fade away like fleeting memories.'),o.setDisabled(!0))}});return o.element.prependTo(e.element),me=setTimeout(ve,1e4),t.setCooldown(8e3),g(),o}let me=null,ge=0;function ve(){d(he[ge]),ge=(ge+1)%he.length,me=setTimeout(ve,O(1e4,2e4))}function we(e,t){t.setName('A Dark Room',!0),new B({id:'sleep',text:'sleep',cooldown:6e4}).appendTo(e.element).setTooltip((new ce).addText('slept enough for now.')).setDisabled(!0),function(e){const t=new B({id:e.id+'-lights',text:'lights on',onClick:()=>{let n='house.room_'+e.id+'.lights',o=w(n,!1);o?(t.setText('lights on'),S(!0)):(t.setText('lights off'),S(!1)),b(n,!o)}});return t}(e).appendTo(e.element).element.one('click',(()=>{t.setName('A Lonely Room')})),S(!0),u(),d('the room is cold.'),setTimeout((()=>{d('a curious face peeks up between the bedsheets.'),G({title:'A Curious Face',scenes:{start:{text:['a strange creature looks up at you inquisitively.'],buttons:{hello:{text:'say hello',click:()=>{d('nothing here yet.')},nextScene:'end'}}}}})}),3e3),clearTimeout(me),me=null,g()}class be extends le{constructor(e,t){super(e,t)}}const ye=new se('house','');function xe(){const e=new be('bedroom','Bedroom').onLoad((e=>{w('progress.intro.finished',!1)||pe(ye),new B({text:'cat',onClick:()=>{let e=function({name:e=null,isFemale:t=I(.5)}={}){null==e&&(e=E((t?A:N).concat(P)));return new V(e,t)}();t.info(e)}}).appendTo(e.element)}));ye.addLocations(e,new be('hallway','Hallway').setVisible(!1)),ae(ye),ye.Init()}const Ce=new se('town','A Quiet Town');function ke(){!function(){let e=$('.main');$('<div>').addClass('area-select').appendTo(e),$('<div>').addClass('area-slider').appendTo(e)}(),xe(),Ce.addLocations(new le('store','Store').onLoad((()=>{})),new le('park','Park')),ae(Ce),Ce.Init(),Ce.setVisible(!1),function(){let e=$('.area-slider');e.width(700*e.children().length+'px')}()}function Te(){let e=$('<div>').addClass('footer').appendTo('body');$('<span>').addClass('footer-button version').text('v'+n.version).appendTo(e),$('<span>').addClass('footer-button github').text('github.').on('click',(()=>{window.open('https://github.com/Drakonkinst/cat-simulation-2')})).appendTo(e),$('<span>').addClass('footer-button').text('discord.').on('click',(()=>{window.open('https://discord.gg/Wrp7Fre')})).appendTo(e),$('<span>').addClass('footer-button').text('options.').on('click',(()=>{G({title:'Options',id:'options',getContext:()=>w('options.lights',0),scenes:{start:e=>({text:['set to heart\'s desire.'],onLoad:()=>{X('Options')},buttons:{lights:{text:$e(e),click:()=>{let e=w('options.lights',0);var t;e=(e+1)%3,b('options.lights',t=e),0==t?L(!1):1==t?L(!0):2==t&&S(T.darkArea),$('.button.button_lights').text($e(e))}},save:{nextScene:'export_import',click:()=>{g()}},restart:{nextScene:'confirm_restart'},close:{nextScene:'end'}}}),confirm_restart:{text:['restart the game?'],onLoad:()=>{X('Restart?')},buttons:{yes:{click:()=>{localStorage.removeItem(n.saveKey),location.reload()},nextScene:'end'},no:{nextScene:'start'}}},export_import:{text:['export or import save data','for backing up or migrating computers'],onLoad:()=>{X('Export / Import')},buttons:{export:{click:()=>{d('nothing here yet.')}},import:{click:()=>{d('nothing here yet.')}},cancel:{nextScene:'start'}}}}},!0)})).appendTo(e)}function $e(e){let t='lights: ';return 0==e?t+='on':1==e?t+='off':2==e&&(t+='adaptive'),t}function Le(){t.setLevel(n.options.loggerLevel),Te(),i=$('<div>').addClass('notifications').appendTo('.wrapper'),l=$('<div>').addClass('notify-gradient').appendTo(i),s=$('<div>').addClass('quick-notify').appendTo('.wrapper'),localStorage.hasOwnProperty(n.saveKey)?v(JSON.parse(localStorage.getItem(n.saveKey))):(b('world.day',1),b('options.lights',0),b('progress.unlocked.town',!1)),q=$('<div>').addClass('events').appendTo('.wrapper'),ke(),m(),window.$SM=x}$((()=>{Le(),re('house'),new B({text:'Hello, world!',tooltip:(new ce).addCost('soul',1).addText('something\'s out there.'),cooldown:1e3,onClick:()=>{t.info('Hello, world!'),d('Hello, world!'),c('Hello, world!'),U()}})}));
//# sourceMappingURL=main.js.map
